# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# https://docs.travis-ci.com/user/ci-environment/
# trusty - 7.5GB memory and 2 cores
sudo: required
dist: trusty

# travis performs a shallow clone by default, in case of any issues
# that requires full git history, enable this
# before_install: git fetch --unshallow

language: java
jdk:
  - oraclejdk8

jobs:
  include:
    - jdk: openjdk11
      arch: amd64
    - jdk: openjdk11
      arch: s390x
    - jdk: openjdk11
      os: linux
      
# disabling cache for /home/travis/.m2/repository/org/apache/hive/hive-jdbc/3.0.0-SNAPSHOT/hive-jdbc-3.0.0-SNAPSHOT-standalone.jar (Permission denied)
cache:
  directories:
  - $HOME/.m2

env:
  MAVEN_SKIP_RC=true
  MAVEN_OPTS="-Xmx2g"
  
before_install:
  - sudo apt install -y maven
  - ls -ltra $HOME/
  - ls -ltra $HOME/.m2
  - ls -ltra $HOME/.m2/repository
  - cat $HOME/.m2/settings.xml
  - sed -i -e 's|https://nexus.codehaus.org/snapshots/|https://oss.sonatype.org/content/repositories/codehaus-snapshots/|g' ~/.m2/settings.xml
# workaround added: https://github.com/travis-ci/travis-ci/issues/4629

install: true

script: mvn clean install -DskipTests -q -Pitests
